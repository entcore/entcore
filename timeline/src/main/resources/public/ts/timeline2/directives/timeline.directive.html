<div pulsar-highlight="1">
    <a class="filter-button" href="#" data-target="timeline-filter"
        pulsar="{ index: 1, i18n: 'timeline.pulsar.filters', position: 'bottom center', className: 'pulse-filters'}">
    <i18n>filters.title</i18n></a>
</div>

<div class="filters filters-chips" id="timeline-filter">
    <div class="filter color-app-multiselect"
            ng-if="ctrl.app.notificationTypes.length > 0">
        <input type="checkbox" class="hidden-checkbox" value="test"
                ng-model="ctrl.isAllSelected" 
                ng-change="ctrl.switchAll()">
        <!-- div class="icon">
            <i class="ic-app multiselect"></i>
        </div -->
        <div class="label"><i18n>filters.all.none</i18n></div>
    </div>

    <div ng-repeat="notifType in ctrl.app.notificationTypes"
            ng-class="ctrl.getFilterClass(notifType)">
        <input type="checkbox" class="hidden-checkbox" value="test"
                ng-model="ctrl.selectedFilter[notifType]"
                ng-change="ctrl.switchFilter(notifType)">
        <div class="icon">
            <i class="ic-app [[ctrl.getCssType(notifType)]]"></i>
        </div>
        <div class="label">[[ctrl.translateType(notifType)]]</div>
    </div>
</div>

<div class="feed-list">

    <!--EMPTY BUT NOT ALL FILTERS SELECTED-->
    <div ng-if="ctrl.app.notifications.length === 0 && !ctrl.isAllSelected">
        <div class="emptyscreen" ng-if="ctrl.isCache && !ctrl.showSeeMoreOnEmpty()">
            <h2 class="emptyscreen-header">
                <i18n>empty.timeline.notifications.noresults.title</i18n>
            </h2>
            <img class="emptyscreen-image__mini" src="/assets/themes/entcore-css-lib/images/empty-filters.svg">
            <p class="emptyscreen-footer">
                <i18n>empty.timeline.notifications.noresults</i18n>
            </p>
        </div>
        <div class="info tuto" ng-if="ctrl.isCache && ctrl.showSeeMoreOnEmpty()">
            <b ><span><i></i><i18n>timeline.empty.cache</i18n></span></b>
        </div>
    </div>
    <!--EMPTY BUT ALL FILTERS SELECTED-->
    <div ng-if="ctrl.app.notifications.length === 0 && ctrl.isAllSelected && !ctrl.app.hasMorePage">
        <div class="emptyscreen" ng-if="ctrl.isCache && !ctrl.showSeeMoreOnEmpty()">
            <h2 class="emptyscreen-header">
                <i18n>empty.timeline.notifications.title</i18n>
            </h2>
            <img class="emptyscreen-image__mini" src="/timeline/public/img/empty-timeline.svg">
            <p class="emptyscreen-footer">
                <i18n>empty.timeline.notifications</i18n>
            </p>
        </div>
        <div class="info tuto" ng-if="ctrl.isCache && ctrl.showSeeMoreOnEmpty()">
            <b ><span><i></i><i18n>timeline.empty.cache</i18n></span></b>
        </div>
    </div>
    <!-- Emptyscreen: no notifications -->
    <div class="emptyscreen" ng-if="ctrl.isEmpty() && !ctrl.isCache">
        <h2 class="emptyscreen-header">
            <i18n>empty.timeline.notifications.title</i18n>
        </h2>
        <img class="emptyscreen-image__mini" src="/timeline/public/img/empty-timeline.svg">
        <p class="emptyscreen-footer">
            <i18n>empty.timeline.notifications</i18n>
        </p>
    </div>

    <!-- Emptyscreen: no results with filters -->
    <div class="emptyscreen" ng-if="ctrl.noResultsWithFilters() && !ctrl.isCache">
        <h2 class="emptyscreen-header">
            <i18n>empty.timeline.notifications.noresults.title</i18n>
        </h2>
        <img class="emptyscreen-image__mini" src="/assets/themes/entcore-css-lib/images/empty-filters.svg">
        <p class="emptyscreen-footer">
            <i18n>empty.timeline.notifications.noresults</i18n>
        </p>
    </div>

    <!-- Emptyscreen: no filters selected -->
    <div class="emptyscreen" ng-if="ctrl.noFiltersSelected() && !ctrl.isCache">
        <h2 class="emptyscreen-header">
            <i18n>empty.timeline.notifications.nofilters.title</i18n>
        </h2>
        <img class="emptyscreen-image__mini" src="/assets/themes/entcore-css-lib/images/empty-filters.svg">
        <p class="emptyscreen-footer">
            <i18n>empty.timeline.notifications.nofilters</i18n>
        </p>
    </div>

    <!-- Results -->
    <div ng-repeat="notif in ctrl.app.notifications track by notif._id">
        <div class="feed-item color-app-[[ctrl.getCssType(notif.model.type)]]">
            <div class="zone-avatar">
    
                <div class="avatar-social">
                    <div class="photo">
                        <img ng-src="/userbook/avatar/[[notif.model.sender]]?thumbnail=100x100" ng-if="notif.model.sender" />
                    </div>
    
                    <div class="circle bg-app-[[ctrl.getCssType(notif.model.type)]]">
                        <i class="ic-app pages-large"></i>
                    </div>
                </div>
    
            </div>

            <div class="zone-text">
    
                <div class="meta">
                    <!-- div class="app-name">Blog</div -->
                    <div class="date">[[ctrl.formatDate(notif.model.date.$date)]]</div>
                </div>
    
                <!--
                <div class="username">
                    <a class="link-discret" href="[[notif.model.params.uri]]">[[notif.model.params.username]]</a> - enseignant, Math√©matiques
                </div>
                -->
    
                <div class="report" ng-bind-html="notif.model.message"></div>
            </div>

            <div class="zone-tools">
                <div class="control"></div>
                <a href="" class="link" 
                    ng-click="notif.discard()"><i18n>timeline.action.discard</i18n></a>
                <a href="" class="link"
                    ng-click="notif.report()"><i18n>timeline.action.report</i18n></a>
            </div>

        </div>        
    </div>
</div>

<timeline-settings></timeline-settings>